#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ì¼€ì–´ë¸Œì´ ì°¨ëŸ‰ ë°°ì°¨ ì•Œê³ ë¦¬ì¦˜
- ì£¼/ë¶€ìš´ì „ì ê·œì¹™ì— ë”°ë¥¸ ì°¨ëŸ‰ ë°°ì •
- ìš´ì „ìëŠ” í•­ìƒ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰
- ì–´ë¥´ì‹  ê²°ì„ ì‹œ íƒ‘ìŠ¹ ìˆœì„œì—ì„œ ì œì™¸
"""

# ============================================
# [1] ê¸°ë³¸ ë°ì´í„° ì„¤ì •
# ============================================

# ë…¸ì„ (ë¼ì¸)ë³„ ìš´ì „ì ë°°ì • (ì¸ë±ìŠ¤ 0 = ì£¼ìš´ì „ì, 1 = ë¶€1, 2 = ë¶€2 ...)
ROUTE_DRIVERS = {
    "ì¹´ë‹ˆë°œ": ["ë°•ì •í˜„", "ì¡°ìˆœì˜¥"],
    "ìŠ¤íƒ€ë¦¬ì•„1": ["ë°©í˜„ì£¼", "ì´ì—°ìˆ™"],
    "ìŠ¤íƒ€ë¦¬ì•„2": ["ì´ê²½ìˆ™", "í™ì€ì˜", "ìµœí˜•ìˆœ"],
    "ìŠ¤íƒ€ë ‰ìŠ¤": ["ìµœí˜•ìˆœ", "í™ì€ì˜"],
    "ë ˆì´": ["ì°¨ë¯¸ìˆ™"],
    "ë‹¤ë§ˆìŠ¤": ["ì •ì„ ë¡€"],
    "ì ë¼í‹°": ["ì •ì¬í›ˆ"],
}

# ìš´ì „ìë³„ ë³¸ì¸ ì†Œìœ  ì°¨ëŸ‰ (ìš´ì „ìëŠ” í•­ìƒ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰!)
DRIVER_OWN_CAR = {
    "ë°•ì •í˜„": "ì¹´ë‹ˆë°œ",
    "ì¡°ìˆœì˜¥": "ì¡°ìˆœì˜¥ì°¨",
    "ë°©í˜„ì£¼": "ìŠ¤íƒ€ë¦¬ì•„1",
    "ì´ì—°ìˆ™": "ì´ì—°ìˆ™ì°¨",
    "ì´ê²½ìˆ™": "ìŠ¤íƒ€ë¦¬ì•„2",
    "í™ì€ì˜": "í™ì€ì˜ì°¨",
    "ìµœí˜•ìˆœ": "ìŠ¤íƒ€ë ‰ìŠ¤",
    "ì°¨ë¯¸ìˆ™": "ë ˆì´",
    "ì •ì„ ë¡€": "ë‹¤ë§ˆìŠ¤",
    "ì •ì¬í›ˆ": "ì ë¼í‹°",
}

# ìš´ì „ìë³„ ì¶œê·¼ í˜„í™© (ë‚ ì§œ: ì¶œê·¼ì—¬ë¶€) - 1 = ì¶œê·¼, 0 = íœ´ë¬´
# ë‚ ì§œ ëª©ë¡ì€ ì—¬ê¸°ì„œ ìë™ ì¶”ì¶œë¨
DRIVER_ATTENDANCE = {
    "ë°•ì •í˜„": {  # ì£¼5ì¼ (1/7ë§Œ íœ´ë¬´ í…ŒìŠ¤íŠ¸)
        2:1, 3:1, 6:1, 7:0, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "ì¡°ìˆœì˜¥": {  # í™”ìˆ˜ê¸ˆë§Œ ì¶œê·¼
        2:0, 3:1, 6:0, 7:1, 8:1, 9:0, 10:1,
        13:0, 14:1, 15:1, 16:0, 17:1,
        20:0, 21:1, 22:1, 23:0, 24:1,
        27:0, 28:1, 29:1, 30:0, 31:1,
    },
    "ë°©í˜„ì£¼": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "ì´ì—°ìˆ™": {  # í™”ìˆ˜ê¸ˆë§Œ ì¶œê·¼
        2:0, 3:1, 6:0, 7:1, 8:1, 9:0, 10:1,
        13:0, 14:1, 15:1, 16:0, 17:1,
        20:0, 21:1, 22:1, 23:0, 24:1,
        27:0, 28:1, 29:1, 30:0, 31:1,
    },
    "ì´ê²½ìˆ™": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "í™ì€ì˜": {  # í™”ìˆ˜ê¸ˆë§Œ ì¶œê·¼
        2:0, 3:1, 6:0, 7:1, 8:1, 9:0, 10:1,
        13:0, 14:1, 15:1, 16:0, 17:1,
        20:0, 21:1, 22:1, 23:0, 24:1,
        27:0, 28:1, 29:1, 30:0, 31:1,
    },
    "ìµœí˜•ìˆœ": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "ì°¨ë¯¸ìˆ™": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "ì •ì„ ë¡€": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
    "ì •ì¬í›ˆ": {  # ì£¼5ì¼
        2:1, 3:1, 6:1, 7:1, 8:1, 9:1, 10:1,
        13:1, 14:1, 15:1, 16:1, 17:1,
        20:1, 21:1, 22:1, 23:1, 24:1,
        27:1, 28:1, 29:1, 30:1, 31:1,
    },
}

# ìš´í–‰ ë‚ ì§œ ìë™ ì¶”ì¶œ (ì¶œê·¼ í˜„í™©ì—ì„œ)
WORK_DATES = sorted(list(DRIVER_ATTENDANCE["ë°•ì •í˜„"].keys()))

# ë…¸ì„ (ë¼ì¸)ë³„ ì–´ë¥´ì‹  íƒ‘ìŠ¹ ìˆœì„œ (í…ŒìŠ¤íŠ¸ ë°ì´í„°)
# ë…¸ì„ ì— ë°°ì •ëœ ì–´ë¥´ì‹ ë“¤ - ìš´í–‰ ì°¨ëŸ‰ì€ ì¶œê·¼í•œ ìš´ì „ìì— ë”°ë¼ ë‹¬ë¼ì§
ROUTE_BOARDING_ORDER = {
    "ì¹´ë‹ˆë°œ": ["ê¹€ìˆœì", "ì´ì˜í¬", "ë°•ë§ìˆœ", "ìµœë³µìˆœ", "ì •ê¸ˆì", "í•œìˆœë•", "ì˜¤ë³µì„", "ê°•ì ë¡€"],
    "ìŠ¤íƒ€ë¦¬ì•„1": ["ìœ¤ì¶˜ì", "ì´ì˜¥ì", "ë°•ì²œì", "ë°•í•™ì„ ", "ì´ì •ì", "ì „ê¸°ìˆœ"],
    "ìŠ¤íƒ€ë¦¬ì•„2": ["ìµœì‚¼ìˆœ", "ê¹€ë¯¼ì", "ì‹ ì• ìˆ™", "í•œì •ìˆ™", "ì •ê¸ˆìˆœ", "ì´ì¶˜ìˆ™"],
    "ìŠ¤íƒ€ë ‰ìŠ¤": ["ë°•ìˆ˜ê·¼", "ë°•ëª…ì„ ", "ì´ì§€ì‚°", "ì„ì¶˜í™”"],
    "ë ˆì´": ["ê¶Œìˆ™ì¸", "ì„œì˜¤ìˆœ", "ê¹€ë§ì", "ì´ë³µìˆœ", "ìµœì •í¬", "ë°•ì˜ì", "í•œìˆœì"],  # 7ì¸
    "ë‹¤ë§ˆìŠ¤": ["ë°°ì‹ í™”", "ì´ì¶˜ì"],
    "ì ë¼í‹°": ["ì´ì¬ìˆœ", "ì¡°í˜œë ¨", "ì´ìˆœì", "ê¹€ì˜íƒœ", "ê¹€ì¥ìˆ˜", "ìµœìˆœì", "ì°¨ì¬ê´‘", "ì´ë³‘ì„ ", "ì•ˆì ë•", "ê¹€ê¸¸ì", "ì´ë‚¨ì„"],
}

# ì–´ë¥´ì‹ ë³„ ê²°ì„ í˜„í™© (ë‚ ì§œ ë¦¬ìŠ¤íŠ¸)
SENIOR_ABSENCE = {
    "ë°•ì¬ëª…": [2],
    "ì†ì€ì": [2],
    "ê¹€ëª…í™˜": [2],
    # í…ŒìŠ¤íŠ¸ìš© ì¶”ê°€ ê²°ì„ ë°ì´í„°
    "ê¹€ìˆœì": [8, 15],      # 1/8, 1/15 ê²°ì„
    "ì´ì˜í¬": [10],         # 1/10 ê²°ì„
    "ë°•ìˆ˜ê·¼": [6, 7, 8],    # 1/6~8 ê²°ì„
}


# ============================================
# [2] í•µì‹¬ ì•Œê³ ë¦¬ì¦˜
# ============================================

def is_driver_working(driver: str, date: int) -> bool:
    """í•´ë‹¹ ë‚ ì§œì— ìš´ì „ìê°€ ì¶œê·¼í•˜ëŠ”ì§€ í™•ì¸"""
    attendance = DRIVER_ATTENDANCE.get(driver, {})
    return attendance.get(date, 0) == 1


def is_senior_absent(senior: str, date: int) -> bool:
    """í•´ë‹¹ ë‚ ì§œì— ì–´ë¥´ì‹ ì´ ê²°ì„ì¸ì§€ í™•ì¸"""
    absent_dates = SENIOR_ABSENCE.get(senior, [])
    return date in absent_dates


def get_route_assignment_for_date(route: str, date: int) -> dict:
    """
    íŠ¹ì • ë‚ ì§œì— ë…¸ì„ ì„ ìš´í–‰í•  ìš´ì „ì ë° ì°¨ëŸ‰ ê²°ì •

    í•µì‹¬: ìš´ì „ìëŠ” í•­ìƒ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰!
    - ì£¼ìš´ì „ì ì¶œê·¼ â†’ ì£¼ìš´ì „ìê°€ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰
    - ì£¼ìš´ì „ì íœ´ë¬´ â†’ ë¶€ìš´ì „ìê°€ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰
    - ëª¨ë‘ íœ´ë¬´ â†’ ìš´í–‰ ì—†ìŒ

    ë°˜í™˜ê°’:
    {
        "route": ë…¸ì„ ëª…,
        "driver": ìš´ì „ìëª… ë˜ëŠ” None,
        "vehicle": ì‹¤ì œ ìš´í–‰ ì°¨ëŸ‰ (ìš´ì „ì ë³¸ì¸ ì°¨ëŸ‰),
        "driver_role": "ì£¼ìš´ì „ì" / "ë¶€1ìš´ì „ì" / None,
        "status": "ì •ìƒ" / "ëŒ€ì²´" / "ìš´í–‰ì—†ìŒ",
    }
    """
    drivers = ROUTE_DRIVERS.get(route, [])

    if not drivers:
        return {
            "route": route,
            "driver": None,
            "vehicle": None,
            "driver_role": None,
            "status": "ìš´í–‰ì—†ìŒ",
        }

    # ì£¼ìš´ì „ì í™•ì¸
    main_driver = drivers[0]
    if is_driver_working(main_driver, date):
        return {
            "route": route,
            "driver": main_driver,
            "vehicle": DRIVER_OWN_CAR.get(main_driver),
            "driver_role": "ì£¼ìš´ì „ì",
            "status": "ì •ìƒ",
        }

    # ì£¼ìš´ì „ì íœ´ë¬´ â†’ ë¶€ìš´ì „ì ìˆœì„œëŒ€ë¡œ í™•ì¸
    for i, sub_driver in enumerate(drivers[1:], start=1):
        if is_driver_working(sub_driver, date):
            return {
                "route": route,
                "driver": sub_driver,
                "vehicle": DRIVER_OWN_CAR.get(sub_driver),  # ë¶€ìš´ì „ì ë³¸ì¸ ì°¨ëŸ‰!
                "driver_role": f"ë¶€{i}ìš´ì „ì",
                "status": "ëŒ€ì²´",
            }

    # ëª¨ë“  ìš´ì „ì íœ´ë¬´
    return {
        "route": route,
        "driver": None,
        "vehicle": None,
        "driver_role": None,
        "status": "ìš´í–‰ì—†ìŒ",
    }


def get_boarding_list_for_date(route: str, date: int) -> list:
    """
    íŠ¹ì • ë‚ ì§œ, íŠ¹ì • ë…¸ì„ ì˜ íƒ‘ìŠ¹ ì–´ë¥´ì‹  ëª©ë¡ (ê²°ì„ì ì œì™¸)
    """
    all_seniors = ROUTE_BOARDING_ORDER.get(route, [])
    return [s for s in all_seniors if not is_senior_absent(s, date)]


def get_daily_dispatch(date: int) -> list:
    """
    íŠ¹ì • ë‚ ì§œì˜ ì „ì²´ ë°°ì°¨ ê²°ê³¼ ë°˜í™˜
    """
    results = []

    for route in ROUTE_DRIVERS.keys():
        assignment = get_route_assignment_for_date(route, date)
        seniors = get_boarding_list_for_date(route, date) if assignment["status"] != "ìš´í–‰ì—†ìŒ" else []

        results.append({
            "route": route,
            "driver": assignment["driver"],
            "vehicle": assignment["vehicle"],
            "role": assignment["driver_role"],
            "status": assignment["status"],
            "seniors": seniors,
        })

    return results


# ============================================
# [3] ì¶œë ¥ í•¨ìˆ˜
# ============================================

def print_daily_dispatch(date: int):
    """íŠ¹ì • ë‚ ì§œì˜ ë°°ì°¨ ê²°ê³¼ ì¶œë ¥ - ê¹”ë”í•œ í˜•ì‹"""
    results = get_daily_dispatch(date)

    print(f"\n{'='*70}")
    print(f"  ğŸ“… 1ì›” {date}ì¼ ë°°ì°¨í‘œ")
    print(f"{'='*70}")

    for item in results:
        route = item["route"]
        driver = item["driver"]
        vehicle = item["vehicle"]
        status = item["status"]
        role = item["role"]
        seniors = item["seniors"]

        if status == "ìš´í–‰ì—†ìŒ":
            print(f"\nâŒ [{route} ë…¸ì„ ] ìš´í–‰ ì—†ìŒ (ëª¨ë“  ìš´ì „ì íœ´ë¬´)")
        else:
            # ìƒíƒœ ì•„ì´ì½˜
            icon = "âœ…" if status == "ì •ìƒ" else "ğŸ”„"
            status_text = "" if status == "ì •ìƒ" else f" (ëŒ€ì²´: {role})"

            print(f"\n{icon} [{route} ë…¸ì„ ]{status_text}")
            print(f"   ìš´ì „ì: {driver}")
            print(f"   ì°¨  ëŸ‰: {vehicle}")
            print(f"   íƒ‘ìŠ¹ì: {' â†’ '.join(seniors) if seniors else 'ì—†ìŒ'}")

    print(f"\n{'='*70}")


def print_compact_dispatch(date: int):
    """íŠ¹ì • ë‚ ì§œì˜ ë°°ì°¨ ê²°ê³¼ - í•œ ì¤„ ì»´íŒ©íŠ¸ í˜•ì‹"""
    results = get_daily_dispatch(date)

    print(f"\nğŸ“… 1ì›” {date}ì¼")
    print("-" * 70)

    for item in results:
        if item["status"] == "ìš´í–‰ì—†ìŒ":
            print(f"âŒ {item['route']} - ìš´í–‰ì—†ìŒ")
        else:
            icon = "âœ…" if item["status"] == "ì •ìƒ" else "ğŸ”„"
            seniors_str = ", ".join(item["seniors"][:3])
            if len(item["seniors"]) > 3:
                seniors_str += f" ì™¸ {len(item['seniors'])-3}ëª…"
            print(f"{icon} {item['vehicle']} - {item['driver']} | {seniors_str}")


# ============================================
# [4] ë©”ì¸ ì‹¤í–‰
# ============================================

if __name__ == "__main__":
    print("\n" + "="*70)
    print("  ğŸš ì¼€ì–´ë¸Œì´ ì°¨ëŸ‰ ë°°ì°¨ ì‹œìŠ¤í…œ")
    print("="*70)

    # ì „ì²´ í‰ì¼ ë°°ì°¨í‘œ ì¶œë ¥
    for date in WORK_DATES:
        print_daily_dispatch(date)

    print("\n\nâœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("="*70)
    print("í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:")
    print("- 1/6(ì›”): ì£¼ìš´ì „ìë“¤ ì •ìƒ ì¶œê·¼ â†’ ë³¸ì¸ ì°¨ëŸ‰ìœ¼ë¡œ ìš´í–‰")
    print("- 1/7(í™”): ë°•ì •í˜„(ì£¼) íœ´ë¬´ â†’ ì¡°ìˆœì˜¥ì´ 'ì¡°ìˆœì˜¥ì°¨'ë¡œ ì¹´ë‹ˆë°œ ë…¸ì„  ëŒ€ì²´ ìš´í–‰")
    print("- 1/8(ìˆ˜): ê¹€ìˆœì ê²°ì„ â†’ ì¹´ë‹ˆë°œ ë…¸ì„  íƒ‘ìŠ¹ìˆœì„œì—ì„œ ì œì™¸")
    print("="*70)
